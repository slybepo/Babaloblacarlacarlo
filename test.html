<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Panoramix — VR Urbex Escape</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet"/>
<style>
  /* Reset + Container */
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { overflow-x: hidden; font-family: 'Orbitron', sans-serif; color: #EEE; background: #050307; }
  a { color: #f04; text-decoration: none; }
  section { padding: 4rem 2rem; max-width: 1000px; margin: auto; position: relative; z-index: 10; }
  h1, h2, h3 { text-align: center; margin-bottom: 1rem; }
  p { margin-bottom: 1.5rem; color: #BBB; line-height: 1.5; }

  /* Intro Button */
  #enterBtn {
    position: fixed; z-index: 20;
    top:50%; left:50%; transform:translate(-50%,-50%);
    padding:1.2rem 2.5rem; font-size:1.2rem; background:#300; border:none;
    color:#EEE; border-radius:8px; cursor:pointer;
    box-shadow: 0 0 20px rgba(255,0,0,0.7);
    animation: pulseBtn 2s infinite;
  }
  #enterBtn:hover { box-shadow: 0 0 35px rgba(255,0,0,1); }
  @keyframes pulseBtn {
    0%,100% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -50%) scale(1.05); }
  }

  /* Canvas background */
  #canvas-container {
    position: fixed; top:0; left:0; width:100vw; height:100vh; z-index: -1;
  }

  /* Content Sections */
  .about { background: rgba(0,0,0,0.4); }
  .features li { margin-bottom: 1rem; }

  /* Footer CTA */
  #cta {
    text-align: center;
    background: rgba(30,0,0,0.4);
    padding-bottom: 4rem;
  }
  #cta button {
    padding:1rem 2rem; background:#f04; border:none; color:#FFF;
    font-size:1.1rem; cursor:pointer; border-radius:6px;
    box-shadow:0 0 10px rgba(240,4,4,0.7);
  }
</style>
</head>
<body>
  <!-- Intro overlay -->
  <button id="enterBtn">Enter Panoramix World</button>

  <!-- Hidden audio -->
  <audio id="bgAudio" src="./Unraveled - Feldup.mp3" loop></audio>
  <div id="canvas-container"></div>

  <!-- Page Content -->
  <section class="about">
    <h1>Panoramix</h1>
    <p>
      Join a group of daring teens who escape their home at night to explore abandoned urban ruins in VR. Panoramix blends stealth, horror, and discovery as you inhabit these eerie spaces, uncovering secrets and evading mysterious watchers.
    </p>
  </section>

  <section class="features">
    <h2>Game Features</h2>
    <ul>
      <li><strong>Immersive VR Urbex:</strong> Explore derelict factories, schools, and tunnels under moonlight.</li>
      <li><strong>Stealth & Strategy:</strong> Hide from supernatural entities and avoid detection.</li>
      <li><strong>Scavenger Hunt:</strong> Find clues & relics linked to the city’s dark past.</li>
      <li><strong>Respiratory Atmosphere:</strong> Bloodflow shader mood, ambient whispers, soundtrack bumping to your heartbeat.</li>
    </ul>
  </section>

  <section id="cta">
    <h2>Ready to face the darkness?</h2>
    <button onclick="alert('Demo coming soon!')">Pre‑Order Now</button>
  </section>

  <!-- Three.js & Post-Processing -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/postprocessing/EffectComposer.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/postprocessing/RenderPass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/postprocessing/ShaderPass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/postprocessing/BloomPass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/shaders/CopyShader.js"></script>

  <script>
    // ───── Variables ─────
    const enterBtn = document.getElementById('enterBtn'),
          audio = document.getElementById('bgAudio'),
          container = document.getElementById('canvas-container');
    let scene, camera, renderer, composer, analyser, dataArray;
    let curve, monsterSprite, uniforms;
    let lastBeat = 0, beatThreshold = 160;

    // ───── Build Scene ─────
    function initScene(){
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
      camera.position.z = 70;

      renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
      renderer.setSize(innerWidth, innerHeight);
      container.appendChild(renderer.domElement);

      // Blood shader
      const bloodShader = {
        uniforms: { uTime:{value:0}, uShake:{value:0} },
        vertexShader:`varying vec2 vUv; void main(){vUv=uv; gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}`,
        fragmentShader:`
          uniform float uTime, uShake; varying vec2 vUv;
          float rand(vec2 c){return fract(sin(dot(c,vec2(12.9898,78.233)))*43758.5);}
          void main(){
            float flow = vUv.y + sin(uTime*0.5+vUv.x*10.)*0.4;
            float blood = smoothstep(0.5,0.6,flow);
            blood *= 1.0 + rand(vUv)*0.1;
            vec3 col = vec3(blood*1.5,0,0) + uShake*0.3;
            gl_FragColor = vec4(col,1.);
          }`
      };
      composer = new THREE.EffectComposer(renderer);
      composer.addPass(new THREE.RenderPass(scene, camera));
      const bloodPass = new THREE.ShaderPass(bloodShader);
      composer.addPass(bloodPass);
      composer.addPass(new THREE.BloomPass(1.2, 8, 0.7, 256));
      uniforms = bloodPass.uniforms;

      // Audio analyzer
      analyser = createAnalyser(256);
      dataArray = new Uint8Array(analyser.frequencyBinCount);

      // Curved waveform
      const geometry = new THREE.BufferGeometry();
      geometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(dataArray.length * 3), 3));
      curve = new THREE.Line(geometry, new THREE.LineBasicMaterial({ color: 0xee3333 }));
      scene.add(curve);

      // Monster sprite
      const tex = new THREE.TextureLoader().load('monster_spritesheet.png', () => tex.repeat.set(1/4, 1));
      tex.magFilter = THREE.NearestFilter;
      monsterSprite = new THREE.Sprite(new THREE.SpriteMaterial({ map:tex, transparent:true }));
      monsterSprite.scale.set(40, 40, 1);
      monsterSprite.position.set(0, -15, 0);
      scene.add(monsterSprite);

      window.addEventListener('resize', onResize);
    }

    function createAnalyser(size){
      const ctx = new (AudioContext||webkitAudioContext)();
      const src = ctx.createMediaElementSource(audio);
      const an = ctx.createAnalyser(); an.fftSize = size;
      src.connect(an); an.connect(ctx.destination);
      return an;
    }

    function detectBeat(avg){
      const now = performance.now();
      if(avg > beatThreshold && now - lastBeat > 300){
        lastBeat = now;
        return true;
      }
      return false;
    }

    function animate(time){
      requestAnimationFrame(animate);
      analyser.getByteFrequencyData(dataArray);

      const pos = curve.geometry.attributes.position.array;
      const len = dataArray.length;
      for(let i=0;i<len;i++){
        const ang=(i/len)*Math.PI*2;
        pos[3*i]=Math.cos(ang)*(25+dataArray[i]*0.1);
        pos[3*i+1]=Math.sin(ang)*(25+dataArray[i]*0.1);
        pos[3*i+2]=Math.sin(time*0.002+ang)*6;
      }
      curve.geometry.attributes.position.needsUpdate=true;

      const avg = dataArray.reduce((a,b)=>a+b)/len;
      if(detectBeat(avg)){
        monsterSprite.material.map.offset.x = (monsterSprite.material.map.offset.x+0.25)%1;
        uniforms.uShake.value = 1.5;
      }
      uniforms.uShake.value *= 0.92;
      uniforms.uTime.value = time*0.001;

      camera.position.x = Math.sin(time*0.0003)*8;
      camera.position.y = Math.sin(time*0.0002)*4;
      camera.lookAt(0,0,0);
      composer.render();
    }

    function onResize(){
      camera.aspect = innerWidth/innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
      composer.setSize(innerWidth, innerHeight);
    }

    // ───── User Entry ─────
    enterBtn.onclick = async () => {
      enterBtn.remove();
      initScene();
      await audio.play();
      requestAnimationFrame(animate);
    }
  </script>
</body>
    </html>
    
